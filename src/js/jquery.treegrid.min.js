!function($){var methods={initTree:function(options){var settings=$.extend({},this.treegrid.defaults,options);return this.each(function(){var $this=$(this);$this.treegrid("setTreeContainer",$(this)),$this.treegrid("setSettings",settings),settings.getRootNodes.apply(this,[$(this)]).treegrid("initNode",settings),$this.treegrid("getRootNodes").treegrid("render")})},initNode:function(settings){return this.each(function(){var $this=$(this);$this.treegrid("setTreeContainer",settings.getTreeGridContainer.apply(this)),$this.treegrid("getChildNodes").treegrid("initNode",settings),$this.treegrid("initExpander").treegrid("initIndent").treegrid("initEvents").treegrid("initState").treegrid("initChangeEvent").treegrid("initSettingsEvents")})},initChangeEvent:function(){var $this=$(this);return $this.on("change",function(){var $this=$(this);$this.treegrid("render"),$this.treegrid("getSetting","saveState")&&$this.treegrid("saveState")}),$this},initEvents:function(){var $this=$(this);return $this.on("collapse",function(){var $this=$(this);$this.removeClass("treegrid-expanded"),$this.addClass("treegrid-collapsed")}),$this.on("expand",function(){var $this=$(this);$this.removeClass("treegrid-collapsed"),$this.addClass("treegrid-expanded")}),$this},initSettingsEvents:function(){var $this=$(this);return $this.on("change",function(){var $this=$(this);"function"==typeof $this.treegrid("getSetting","onChange")&&$this.treegrid("getSetting","onChange").apply($this)}),$this.on("collapse",function(){var $this=$(this);"function"==typeof $this.treegrid("getSetting","onCollapse")&&$this.treegrid("getSetting","onCollapse").apply($this)}),$this.on("expand",function(){var $this=$(this);"function"==typeof $this.treegrid("getSetting","onExpand")&&$this.treegrid("getSetting","onExpand").apply($this)}),$this},initExpander:function(){var $this=$(this),cell=$this.find("td").get($this.treegrid("getSetting","treeColumn")),tpl=$this.treegrid("getSetting","expanderTemplate"),expander=$this.treegrid("getSetting","getExpander").apply(this);return expander&&expander.remove(),$(tpl).prependTo(cell).click(function(){$($(this).closest("tr")).treegrid("toggle")}),$this},initIndent:function(){for(var $this=$(this),tpl=($this.find(".treegrid-indent").remove(),$this.treegrid("getSetting","indentTemplate")),expander=$this.find(".treegrid-expander"),depth=$this.treegrid("getDepth"),i=0;i<depth;i++)$(tpl).insertBefore(expander);return $this},initState:function(){var $this=$(this);return $this.treegrid("getSetting","saveState")&&!$this.treegrid("isFirstInit")?$this.treegrid("restoreState"):"expanded"===$this.treegrid("getSetting","initialState")?$this.treegrid("expand"):$this.treegrid("collapse"),$this},isFirstInit:function(){var tree=$(this).treegrid("getTreeContainer");return void 0===tree.data("first_init")&&tree.data("first_init",void 0===$.cookie(tree.treegrid("getSetting","saveStateName"))),tree.data("first_init")},saveState:function(){var stateArrayString,nodeId,$this=$(this);return"cookie"===$this.treegrid("getSetting","saveStateMethod")&&(stateArrayString=""===(stateArrayString=$.cookie($this.treegrid("getSetting","saveStateName"))||"")?[]:stateArrayString.split(","),nodeId=$this.treegrid("getNodeId"),$this.treegrid("isExpanded")?-1===$.inArray(nodeId,stateArrayString)&&stateArrayString.push(nodeId):$this.treegrid("isCollapsed")&&-1!==$.inArray(nodeId,stateArrayString)&&stateArrayString.splice($.inArray(nodeId,stateArrayString),1),$.cookie($this.treegrid("getSetting","saveStateName"),stateArrayString.join(","))),$this},restoreState:function(){var stateArray,$this=$(this);return"cookie"===$this.treegrid("getSetting","saveStateMethod")&&(stateArray=$.cookie($this.treegrid("getSetting","saveStateName")).split(","),-1!==$.inArray($this.treegrid("getNodeId"),stateArray)?$this.treegrid("expand"):$this.treegrid("collapse")),$this},getSetting:function(name){return $(this).treegrid("getTreeContainer")?$(this).treegrid("getTreeContainer").data("settings")[name]:null},setSettings:function(settings){$(this).treegrid("getTreeContainer").data("settings",settings)},getTreeContainer:function(){return $(this).data("treegrid")},setTreeContainer:function(container){return $(this).data("treegrid",container)},getRootNodes:function(){return $(this).treegrid("getSetting","getRootNodes").apply(this,[$(this).treegrid("getTreeContainer")])},getAllNodes:function(){return $(this).treegrid("getSetting","getAllNodes").apply(this,[$(this).treegrid("getTreeContainer")])},isNode:function(){return null!==$(this).treegrid("getNodeId")},getNodeId:function(){return null===$(this).treegrid("getSetting","getNodeId")?null:$(this).treegrid("getSetting","getNodeId").apply(this)},getParentNodeId:function(){return $(this).treegrid("getSetting","getParentNodeId").apply(this)},getParentNode:function(){return null===$(this).treegrid("getParentNodeId")?null:$(this).treegrid("getSetting","getNodeById").apply(this,[$(this).treegrid("getParentNodeId"),$(this).treegrid("getTreeContainer")])},getChildNodes:function(){return $(this).treegrid("getSetting","getChildNodes").apply(this,[$(this).treegrid("getNodeId"),$(this).treegrid("getTreeContainer")])},getDepth:function(){return null===$(this).treegrid("getParentNode")?0:$(this).treegrid("getParentNode").treegrid("getDepth")+1},isRoot:function(){return 0===$(this).treegrid("getDepth")},isLeaf:function(){return 0===$(this).treegrid("getChildNodes").length},isLast:function(){if($(this).treegrid("isNode")){var parentNode=$(this).treegrid("getParentNode");if(null===parentNode){if($(this).treegrid("getNodeId")===$(this).treegrid("getRootNodes").last().treegrid("getNodeId"))return!0}else if($(this).treegrid("getNodeId")===parentNode.treegrid("getChildNodes").last().treegrid("getNodeId"))return!0}return!1},isFirst:function(){if($(this).treegrid("isNode")){var parentNode=$(this).treegrid("getParentNode");if(null===parentNode){if($(this).treegrid("getNodeId")===$(this).treegrid("getRootNodes").first().treegrid("getNodeId"))return!0}else if($(this).treegrid("getNodeId")===parentNode.treegrid("getChildNodes").first().treegrid("getNodeId"))return!0}return!1},isExpanded:function(){return $(this).hasClass("treegrid-expanded")},isCollapsed:function(){return $(this).hasClass("treegrid-collapsed")},isOneOfParentsCollapsed:function(){var $this=$(this);return!$this.treegrid("isRoot")&&(!!$this.treegrid("getParentNode").treegrid("isCollapsed")||$this.treegrid("getParentNode").treegrid("isOneOfParentsCollapsed"))},expand:function(){return this.treegrid("isLeaf")||this.treegrid("isExpanded")||(this.trigger("expand"),this.trigger("change")),this},expandAll:function(){var $this=$(this);return $this.treegrid("getRootNodes").treegrid("expandRecursive"),$this},expandRecursive:function(){return $(this).each(function(){var $this=$(this);$this.treegrid("expand"),$this.treegrid("isLeaf")||$this.treegrid("getChildNodes").treegrid("expandRecursive")})},collapse:function(){return $(this).each(function(){var $this=$(this);$this.treegrid("isLeaf")||$this.treegrid("isCollapsed")||($this.trigger("collapse"),$this.trigger("change"))})},collapseAll:function(){var $this=$(this);return $this.treegrid("getRootNodes").treegrid("collapseRecursive"),$this},collapseRecursive:function(){return $(this).each(function(){var $this=$(this);$this.treegrid("collapse"),$this.treegrid("isLeaf")||$this.treegrid("getChildNodes").treegrid("collapseRecursive")})},toggle:function(){var $this=$(this);return $this.treegrid("isExpanded")?$this.treegrid("collapse"):$this.treegrid("expand"),$this},render:function(){return $(this).each(function(){var $this=$(this);$this.treegrid("isOneOfParentsCollapsed")?$this.hide():$this.show(),$this.treegrid("isLeaf")||($this.treegrid("renderExpander"),$this.treegrid("getChildNodes").treegrid("render"))})},renderExpander:function(){return $(this).each(function(){var $this=$(this),expander=$this.treegrid("getSetting","getExpander").apply(this);expander?$this.treegrid("isCollapsed")?(expander.removeClass($this.treegrid("getSetting","expanderExpandedClass")),expander.addClass($this.treegrid("getSetting","expanderCollapsedClass"))):(expander.removeClass($this.treegrid("getSetting","expanderCollapsedClass")),expander.addClass($this.treegrid("getSetting","expanderExpandedClass"))):($this.treegrid("initExpander"),$this.treegrid("renderExpander"))})}};$.fn.treegrid=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method with name "+method+" does not exists for jQuery.treegrid"):methods.initTree.apply(this,arguments)},$.fn.treegrid.defaults={initialState:"expanded",saveState:!1,saveStateMethod:"cookie",saveStateName:"tree-grid-state",expanderTemplate:'<span class="treegrid-expander"></span>',indentTemplate:'<span class="treegrid-indent"></span>',expanderExpandedClass:"treegrid-expander-expanded",expanderCollapsedClass:"treegrid-expander-collapsed",treeColumn:0,getExpander:function(){return $(this).find(".treegrid-expander")},getNodeId:function(){var template=/treegrid-([A-Za-z0-9_-]+)/;return template.test($(this).attr("class"))?template.exec($(this).attr("class"))[1]:null},getParentNodeId:function(){var template=/treegrid-parent-([A-Za-z0-9_-]+)/;return template.test($(this).attr("class"))?template.exec($(this).attr("class"))[1]:null},getNodeById:function(id,treegridContainer){return treegridContainer.find("tr."+("treegrid-"+id))},getChildNodes:function(id,treegridContainer){return treegridContainer.find("tr."+("treegrid-parent-"+id))},getTreeGridContainer:function(){return $(this).closest("table")},getRootNodes:function(treegridContainer){treegridContainer=$.grep(treegridContainer.find("tr"),function(element){element=$(element).attr("class");return/treegrid-([A-Za-z0-9_-]+)/.test(element)&&!/treegrid-parent-([A-Za-z0-9_-]+)/.test(element)});return $(treegridContainer)},getAllNodes:function(treegridContainer){treegridContainer=$.grep(treegridContainer.find("tr"),function(element){element=$(element).attr("class");return/treegrid-([A-Za-z0-9_-]+)/.test(element)});return $(treegridContainer)},onCollapse:null,onExpand:null,onChange:null}}(jQuery);